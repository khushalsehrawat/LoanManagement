services:
  db:
    image: postgres:16-alpine
    container_name: lms-db
    environment:
      POSTGRES_DB: loanManagement
      POSTGRES_USER: lms_user
      POSTGRES_PASSWORD: lms_pass
    ports:
      - "5432:5432"
    volumes:
      - lms_pgdata:/var/lib/postgresql/data

  backend:
    build:
      context: ./Backend
      dockerfile: Dockerfile
    container_name: lms-backend
    depends_on:
      - db
    ports:
      - "8080:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://db:5432/loanManagement
      SPRING_DATASOURCE_USERNAME: lms_user
      SPRING_DATASOURCE_PASSWORD: lms_pass

      # IMPORTANT: Production-like behavior (donâ€™t wipe DB)
      SPRING_SQL_INIT_MODE: never
      SPRING_JPA_HIBERNATE_DDL_AUTO: update

      APP_JWT_SECRET: "CHANGE_ME_TO_A_LONG_RANDOM_SECRET_32_CHARS_MIN"
      APP_ADMIN_USERNAME: "admin"
      APP_ADMIN_PASSWORD: "admin123"

      APP_PARTNER_API_KEY_HEADER: "X-API-KEY"

  frontend:
    build:
      context: ./Frontend
      dockerfile: Dockerfile
    container_name: lms-frontend
    depends_on:
      - backend
    ports:
      - "5500:80"

volumes:
  lms_pgdata:
